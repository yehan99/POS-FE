<div class="customer-form-container">
  <!-- Header -->
  <div class="header">
    <div class="title-section">
      <h1>{{ isEditMode ? 'Edit Customer' : 'New Customer' }}</h1>
      <p class="subtitle" *ngIf="customerCode">Customer Code: <strong>{{ customerCode }}</strong></p>
    </div>
    <div class="action-buttons">
      <button mat-stroked-button (click)="onCancel()" [disabled]="isLoading">
        <mat-icon>close</mat-icon>
        Cancel
      </button>
      <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="isLoading || customerForm.invalid">
        <mat-icon>save</mat-icon>
        {{ isEditMode ? 'Update' : 'Create' }}
      </button>
    </div>
  </div>

  <!-- Form Content -->
  <form [formGroup]="customerForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">

    <!-- Personal Information -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>person</mat-icon>
          Personal Information
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="firstName" placeholder="Enter first name" required>
            <mat-error *ngIf="hasError('firstName', 'required')">First name is required</mat-error>
            <mat-error *ngIf="hasError('firstName', 'minlength')">{{ getErrorMessage('firstName') }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="lastName" placeholder="Enter last name" required>
            <mat-error *ngIf="hasError('lastName', 'required')">Last name is required</mat-error>
            <mat-error *ngIf="hasError('lastName', 'minlength')">{{ getErrorMessage('lastName') }}</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Phone Number</mat-label>
            <input matInput formControlName="phone" placeholder="0771234567" required maxlength="10">
            <mat-icon matPrefix>phone</mat-icon>
            <mat-error>{{ getErrorMessage('phone') }}</mat-error>
            <mat-hint>10 digit phone number</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email (Optional)</mat-label>
            <input matInput formControlName="email" type="email" placeholder="customer@example.com">
            <mat-icon matPrefix>email</mat-icon>
            <mat-error>{{ getErrorMessage('email') }}</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Date of Birth (Optional)</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="dateOfBirth">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Gender (Optional)</mat-label>
            <mat-select formControlName="gender">
              <mat-option value="">Not specified</mat-option>
              <mat-option *ngFor="let gender of genders" [value]="gender">
                {{ gender | titlecase }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Address Information -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>location_on</mat-icon>
          Address Information (Optional)
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-row full-width">
          <mat-form-field appearance="outline">
            <mat-label>Street Address</mat-label>
            <input matInput formControlName="street" placeholder="123 Main Street">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" placeholder="Colombo">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>State/Province</mat-label>
            <input matInput formControlName="state" placeholder="Western Province">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Postal Code</mat-label>
            <input matInput formControlName="postalCode" placeholder="10100">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Country</mat-label>
            <input matInput formControlName="country" required>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Loyalty Information -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>stars</mat-icon>
          Loyalty Program
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Loyalty Points</mat-label>
            <input matInput formControlName="loyaltyPoints" type="number" readonly>
            <mat-icon matPrefix>star</mat-icon>
            <mat-hint>Points are automatically calculated based on purchases</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Loyalty Tier</mat-label>
            <mat-select formControlName="loyaltyTier">
              <mat-option *ngFor="let tier of loyaltyTiers" [value]="tier">
                <span class="tier-option" [style.color]="getTierColor(tier)">
                  {{ tier | titlecase }}
                </span>
              </mat-option>
            </mat-select>
            <mat-hint *ngIf="customerForm.get('loyaltyTier')?.value">
              {{ getTierDescription(customerForm.get('loyaltyTier')?.value) }}
            </mat-hint>
          </mat-form-field>
        </div>

        <div class="tier-info-card">
          <div class="tier-card" *ngFor="let tier of loyaltyTiers">
            <div class="tier-icon" [style.backgroundColor]="getTierColor(tier)">
              <mat-icon>{{ tier === 'platinum' ? 'star' : 'workspace_premium' }}</mat-icon>
            </div>
            <div class="tier-details">
              <strong>{{ tier | titlecase }}</strong>
              <p>{{ getTierDescription(tier) }}</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Additional Information -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>notes</mat-icon>
          Additional Information
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-row full-width">
          <mat-form-field appearance="outline">
            <mat-label>Notes</mat-label>
            <textarea matInput formControlName="notes" rows="4"
              placeholder="Add any additional notes about this customer..."></textarea>
            <mat-hint align="end">{{ customerForm.get('notes')?.value?.length || 0 }}/500</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-slide-toggle formControlName="isActive" color="primary">
            Customer is Active
          </mat-slide-toggle>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button mat-stroked-button type="button" (click)="onCancel()" [disabled]="isLoading">
        Cancel
      </button>
      <button mat-raised-button color="primary" type="submit" [disabled]="isLoading || customerForm.invalid">
        <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
        {{ isEditMode ? 'Update Customer' : 'Create Customer' }}
      </button>
    </div>
  </form>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>{{ isEditMode ? 'Loading customer...' : 'Saving customer...' }}</p>
  </div>
</div>
