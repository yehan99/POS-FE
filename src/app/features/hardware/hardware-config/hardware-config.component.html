<section class="hardware-config-dashboard">
  <header class="page-header">
    <div class="page-header__title">
      <button mat-icon-button routerLink="/dashboard" matTooltip="Back to dashboard" class="ghost-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div>
        <p class="eyebrow">System Configuration</p>
        <h1>Hardware Configuration</h1>
        <p class="subtitle">Manage and configure hardware devices for your POS system.</p>
      </div>
    </div>
    <div class="page-header__actions">
      <button mat-stroked-button type="button" (click)="toggleEventLog()">
        <mat-icon>event_note</mat-icon>
        {{ showEventLog ? 'Hide' : 'Show' }} Event Log
      </button>
      <button mat-flat-button color="primary" type="button" class="action-primary" [matMenuTriggerFor]="addMenu">
        <mat-icon>add</mat-icon>
        Add Device
      </button>
      <mat-menu #addMenu="matMenu">
        <button mat-menu-item (click)="addDevice(deviceTypes[0])">
          <mat-icon>print</mat-icon>
          <span>Printer</span>
        </button>
        <button mat-menu-item (click)="addDevice(deviceTypes[1])">
          <mat-icon>qr_code_scanner</mat-icon>
          <span>Scanner</span>
        </button>
        <button mat-menu-item (click)="addDevice(deviceTypes[2])">
          <mat-icon>point_of_sale</mat-icon>
          <span>Cash Drawer</span>
        </button>
        <button mat-menu-item (click)="addDevice(deviceTypes[3])">
          <mat-icon>credit_card</mat-icon>
          <span>Payment Terminal</span>
        </button>
      </mat-menu>
    </div>
  </header>

  <!-- Summary Cards -->
  <div class="summary-grid">
    <app-card variant="elevated" padding="medium" class="summary-card">
      <div class="summary-card__content">
        <div class="summary-card__icon summary-card__icon--primary">
          <mat-icon>devices</mat-icon>
        </div>
        <div class="summary-card__info">
          <span class="summary-card__label">Total Devices</span>
          <span class="summary-card__value">{{ connectionStatus.total }}</span>
        </div>
      </div>
    </app-card>

    <app-card variant="elevated" padding="medium" class="summary-card">
      <div class="summary-card__content">
        <div class="summary-card__icon summary-card__icon--success">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="summary-card__info">
          <span class="summary-card__label">Connected</span>
          <span class="summary-card__value">{{ connectionStatus.connected }}</span>
        </div>
      </div>
    </app-card>

    <app-card variant="elevated" padding="medium" class="summary-card">
      <div class="summary-card__content">
        <div class="summary-card__icon summary-card__icon--warning">
          <mat-icon>cancel</mat-icon>
        </div>
        <div class="summary-card__info">
          <span class="summary-card__label">Disconnected</span>
          <span class="summary-card__value">{{ connectionStatus.disconnected }}</span>
        </div>
      </div>
    </app-card>

    <app-card variant="elevated" padding="medium" class="summary-card">
      <div class="summary-card__content">
        <div class="summary-card__icon summary-card__icon--critical">
          <mat-icon>error</mat-icon>
        </div>
        <div class="summary-card__info">
          <span class="summary-card__label">Error</span>
          <span class="summary-card__value">{{ connectionStatus.error }}</span>
        </div>
      </div>
    </app-card>
  </div>

  <!-- Filters -->
  <app-card variant="elevated" padding="large" class="filters-card">
    <div class="filters-card__header">
      <h3>Filters</h3>
      <span class="meta">Refine your device view</span>
    </div>
    <div class="filters-form">
      <mat-form-field appearance="outline">
        <mat-label>Device Type</mat-label>
        <mat-select [(ngModel)]="filterType" (selectionChange)="applyFilters()">
          <mat-option value="ALL">All Types</mat-option>
          <mat-option *ngFor="let type of deviceTypes" [value]="type">
            {{ type | titlecase }}
          </mat-option>
        </mat-select>
        <mat-icon matPrefix>category</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Search Devices</mat-label>
        <input matInput [(ngModel)]="searchQuery" (input)="applyFilters()" placeholder="Search by name or type">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <button mat-stroked-button type="button" (click)="filterType='ALL'; searchQuery=''; applyFilters()"
        *ngIf="filterType !== 'ALL' || searchQuery">
        <mat-icon>filter_alt_off</mat-icon>
        Clear Filters
      </button>
    </div>
  </app-card>

  <!-- Devices List -->
  <app-card variant="elevated" padding="large" class="devices-card">
    <div class="devices-card__header">
      <div>
        <h2>Connected Devices</h2>
        <span class="meta">{{ filteredDevices.length }} device(s) found</span>
      </div>
      <button mat-stroked-button type="button" color="warn" (click)="clearAllDevices()" *ngIf="devices.length > 0">
        <mat-icon>delete_sweep</mat-icon>
        Clear All
      </button>
    </div>

    <!-- Device Cards Grid -->
    <div class="device-grid" *ngIf="filteredDevices.length > 0">
      <div class="device-card" *ngFor="let device of filteredDevices"
        [class.device-card--selected]="selectedDevice?.id === device.id" (click)="selectDevice(device)"
        (keydown.enter)="selectDevice(device)" (keydown.space)="selectDevice(device)" tabindex="0" role="button"
        [attr.aria-label]="'Select ' + device.name">
        <div class="device-card__header">
          <div class="device-card__icon" [ngClass]="'device-card__icon--' + getStatusColor(device.status)">
            <mat-icon>{{ getDeviceIcon(device.type) }}</mat-icon>
          </div>
          <div class="device-card__info">
            <h4>{{ device.name }}</h4>
            <span class="device-type">{{ device.type | titlecase }}</span>
          </div>
          <mat-slide-toggle [checked]="device.enabled" (change)="toggleDevice(device)"
            (click)="$event.stopPropagation()" color="primary">
          </mat-slide-toggle>
        </div>

        <div class="device-card__details">
          <div class="device-detail">
            <mat-icon class="detail-icon">settings_input_composite</mat-icon>
            <span>{{ device.connectionType | titlecase }}</span>
          </div>
          <div class="device-detail">
            <mat-icon class="detail-icon" [ngClass]="'status-' + device.status">
              {{ getStatusIcon(device.status) }}
            </mat-icon>
            <span>{{ device.status | titlecase }}</span>
          </div>
        </div>

        <div class="device-card__actions">
          <button mat-button type="button" (click)="testDevice(device); $event.stopPropagation()">
            <mat-icon>cable</mat-icon>
            Test Connection
          </button>
          <button mat-button type="button" *ngIf="device.type === 'PRINTER'"
            (click)="testPrint(device); $event.stopPropagation()">
            <mat-icon>print</mat-icon>
            Test Print
          </button>
          <button mat-button type="button" *ngIf="device.type === 'CASH_DRAWER'"
            (click)="testDrawer(device); $event.stopPropagation()">
            <mat-icon>point_of_sale</mat-icon>
            Open Drawer
          </button>
          <button mat-button type="button" *ngIf="device.type === 'PAYMENT_TERMINAL'"
            (click)="testTerminal(device); $event.stopPropagation()">
            <mat-icon>credit_card</mat-icon>
            Test Terminal
          </button>
          <button mat-icon-button type="button" color="warn" (click)="removeDevice(device); $event.stopPropagation()"
            matTooltip="Remove device">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="filteredDevices.length === 0">
      <mat-icon>devices_other</mat-icon>
      <h3>No devices found</h3>
      <p *ngIf="filterType !== 'ALL' || searchQuery">Try adjusting your filters or search query.</p>
      <p *ngIf="filterType === 'ALL' && !searchQuery && devices.length === 0">
        Get started by adding your first hardware device.
      </p>
      <button mat-flat-button color="primary" type="button" [matMenuTriggerFor]="addMenuEmpty"
        *ngIf="devices.length === 0">
        <mat-icon>add</mat-icon>
        Add Your First Device
      </button>
      <mat-menu #addMenuEmpty="matMenu">
        <button mat-menu-item (click)="addDevice(deviceTypes[0])">
          <mat-icon>print</mat-icon>
          <span>Printer</span>
        </button>
        <button mat-menu-item (click)="addDevice(deviceTypes[1])">
          <mat-icon>qr_code_scanner</mat-icon>
          <span>Scanner</span>
        </button>
        <button mat-menu-item (click)="addDevice(deviceTypes[2])">
          <mat-icon>point_of_sale</mat-icon>
          <span>Cash Drawer</span>
        </button>
        <button mat-menu-item (click)="addDevice(deviceTypes[3])">
          <mat-icon>credit_card</mat-icon>
          <span>Payment Terminal</span>
        </button>
      </mat-menu>
    </div>
  </app-card>

  <!-- Event Log -->
  <app-card variant="elevated" padding="large" class="event-log-card" *ngIf="showEventLog">
    <div class="event-log-card__header">
      <div>
        <h2>Event Log</h2>
        <span class="meta">{{ recentEvents.length }} event(s)</span>
      </div>
      <button mat-stroked-button type="button" (click)="clearEventLog()" *ngIf="recentEvents.length > 0">
        <mat-icon>clear_all</mat-icon>
        Clear Log
      </button>
    </div>

    <div class="event-log-list" *ngIf="recentEvents.length > 0">
      <div class="event-item" *ngFor="let event of recentEvents">
        <div class="event-item__icon" [ngClass]="{
          'event-item__icon--error': event.type.includes('ERROR'),
          'event-item__icon--warning': event.type.includes('DISCONNECTED'),
          'event-item__icon--success': event.type.includes('CONNECTED'),
          'event-item__icon--info': !event.type.includes('ERROR') && !event.type.includes('DISCONNECTED') && !event.type.includes('CONNECTED')
        }">
          <mat-icon *ngIf="event.type.includes('ERROR')">error</mat-icon>
          <mat-icon *ngIf="event.type.includes('DISCONNECTED')">warning</mat-icon>
          <mat-icon *ngIf="event.type.includes('CONNECTED')">check_circle</mat-icon>
          <mat-icon
            *ngIf="!event.type.includes('ERROR') && !event.type.includes('DISCONNECTED') && !event.type.includes('CONNECTED')">
            info
          </mat-icon>
        </div>
        <div class="event-item__content">
          <div class="event-item__type">{{ event.type }}</div>
          <div class="event-item__details">
            <span class="event-device">Device: {{ event.deviceId }}</span>
            <span class="event-time">{{ formatTimestamp(event.timestamp) }}</span>
          </div>
          <div class="event-item__data" *ngIf="event.data">{{ event.data | json }}</div>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="recentEvents.length === 0">
      <mat-icon>event_note</mat-icon>
      <h3>No events yet</h3>
      <p>Hardware events will appear here as they occur.</p>
    </div>
  </app-card>
</section>
