<div class="stock-alerts-container">
  <!-- Header -->
  <div class="header">
    <div class="title-section">
      <h1>Stock Alerts</h1>
      <p class="subtitle">Monitor low stock, overstock, and expiry warnings</p>
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <form [formGroup]="filterForm" class="filters-form">
        <mat-form-field appearance="outline">
          <mat-label>Alert Type</mat-label>
          <mat-select formControlName="type">
            <mat-option value="">All Types</mat-option>
            <mat-option *ngFor="let type of alertTypes" [value]="type">
              {{ type.replace('_', ' ') | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option value="">All Statuses</mat-option>
            <mat-option *ngFor="let status of alertStatuses" [value]="status">
              {{ status | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-stroked-button type="button" (click)="clearFilters()" class="clear-btn">
          <mat-icon>clear</mat-icon>
          Clear
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Bulk Actions -->
  <div class="bulk-actions" *ngIf="selection.selected.length > 0">
    <span class="selection-count">{{ selection.selected.length }} alert(s) selected</span>
    <button mat-raised-button color="primary" (click)="bulkAcknowledge()">
      <mat-icon>check</mat-icon>
      Acknowledge Selected
    </button>
  </div>

  <!-- Alerts Table -->
  <mat-card class="table-card">
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="dataSource" matSort>

          <!-- Checkbox Column -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
              <mat-checkbox (change)="$event ? toggleAllRows() : null"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()">
              </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let row">
              <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)">
              </mat-checkbox>
            </td>
          </ng-container>

          <!-- Severity Column -->
          <ng-container matColumnDef="severity">
            <th mat-header-cell *matHeaderCellDef>Severity</th>
            <td mat-cell *matCellDef="let alert">
              <span class="severity-badge" [style.backgroundColor]="getSeverityColor(alert.severity)">
                {{ alert.severity | titlecase }}
              </span>
            </td>
          </ng-container>

          <!-- Type Column -->
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let alert">
              <div class="type-badge" [style.color]="getTypeColor(alert.alertType)">
                <mat-icon>{{ getTypeIcon(alert.alertType) }}</mat-icon>
                <span>{{ alert.alertType.replace('_', ' ') | titlecase }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Product Column -->
          <ng-container matColumnDef="product">
            <th mat-header-cell *matHeaderCellDef>Product</th>
            <td mat-cell *matCellDef="let alert">
              <div class="product-info">
                <strong>{{ alert.productName }}</strong>
                <span class="product-sku">{{ alert.productSku }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Current Stock Column -->
          <ng-container matColumnDef="currentStock">
            <th mat-header-cell *matHeaderCellDef>Current Stock</th>
            <td mat-cell *matCellDef="let alert">
              <span class="stock-value" [class.critical]="alert.currentStock === 0">
                {{ alert.currentStock }}
              </span>
            </td>
          </ng-container>

          <!-- Threshold Column -->
          <ng-container matColumnDef="threshold">
            <th mat-header-cell *matHeaderCellDef>Threshold</th>
            <td mat-cell *matCellDef="let alert">
              {{ alert.threshold || 'N/A' }}
            </td>
          </ng-container>

          <!-- Location Column -->
          <ng-container matColumnDef="location">
            <th mat-header-cell *matHeaderCellDef>Location</th>
            <td mat-cell *matCellDef="let alert">
              {{ alert.locationName || 'All Locations' }}
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let alert">
              <span class="status-badge" [class]="alert.status">
                {{ alert.status | titlecase }}
              </span>
            </td>
          </ng-container>

          <!-- Created At Column -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Created</th>
            <td mat-cell *matCellDef="let alert">
              {{ formatDate(alert.createdAt) }}
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let alert">
              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="acknowledgeAlert(alert)" *ngIf="alert.status === 'active'">
                  <mat-icon>check</mat-icon>
                  <span>Acknowledge</span>
                </button>
                <button mat-menu-item (click)="resolveAlert(alert)" *ngIf="alert.status !== 'resolved'">
                  <mat-icon>check_circle</mat-icon>
                  <span>Resolve</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <!-- Loading Spinner -->
        <div class="loading-spinner" *ngIf="isLoading">
          <mat-spinner diameter="50"></mat-spinner>
        </div>

        <!-- No Data -->
        <div class="no-data" *ngIf="!isLoading && dataSource.data.length === 0">
          <mat-icon>notifications_none</mat-icon>
          <p>No alerts found</p>
        </div>
      </div>

      <!-- Paginator -->
      <mat-paginator [length]="totalAlerts" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25, 50]"
        (page)="onPageChange($event)" showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
