<div class="sales-reports-container">
  <!-- Header -->
  <div class="header">
    <div class="title-section">
      <button mat-icon-button routerLink="/reports">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div>
        <h1>Sales Reports</h1>
        <p class="subtitle">Comprehensive sales analytics and performance metrics</p>
      </div>
    </div>
    <div class="action-buttons">
      <button mat-raised-button (click)="exportReport('pdf')">
        <mat-icon>picture_as_pdf</mat-icon>
        PDF
      </button>
      <button mat-raised-button (click)="exportReport('excel')">
        <mat-icon>table_chart</mat-icon>
        Excel
      </button>
      <button mat-raised-button (click)="exportReport('csv')">
        <mat-icon>file_download</mat-icon>
        CSV
      </button>
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <form [formGroup]="filterForm" class="filters-form">
      <mat-form-field appearance="outline">
        <mat-label>Period</mat-label>
        <mat-select formControlName="period">
          <mat-option *ngFor="let period of reportPeriods" [value]="period.value">
            {{ period.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" *ngIf="showCustomDateRange">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startPicker" formControlName="startDate">
        <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" *ngIf="showCustomDateRange">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endPicker" formControlName="endDate">
        <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>
    </form>
  </mat-card>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading sales data...</p>
  </div>

  <!-- Summary Cards -->
  <div class="summary-grid" *ngIf="!isLoading && salesReport">
    <mat-card class="summary-card">
      <mat-card-content>
        <div class="card-icon sales">
          <mat-icon>payments</mat-icon>
        </div>
        <div class="card-info">
          <p class="card-label">Total Sales</p>
          <p class="card-value">{{ formatCurrency(salesReport.totalSales) }}</p>
          <p class="card-subtitle">Net: {{ formatCurrency(salesReport.netSales) }}</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-content>
        <div class="card-icon transactions">
          <mat-icon>receipt</mat-icon>
        </div>
        <div class="card-info">
          <p class="card-label">Transactions</p>
          <p class="card-value">{{ salesReport.totalTransactions }}</p>
          <p class="card-subtitle">{{ salesReport.totalItems }} items sold</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-content>
        <div class="card-icon average">
          <mat-icon>account_balance_wallet</mat-icon>
        </div>
        <div class="card-info">
          <p class="card-label">Avg Transaction</p>
          <p class="card-value">{{ formatCurrency(salesReport.averageTransactionValue) }}</p>
          <p class="card-subtitle">Per transaction</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-content>
        <div class="card-icon profit">
          <mat-icon>trending_up</mat-icon>
        </div>
        <div class="card-info">
          <p class="card-label">Gross Profit</p>
          <p class="card-value">{{ formatCurrency(salesReport.grossProfit) }}</p>
          <p class="card-subtitle">{{ formatPercentage(salesReport.grossProfitMargin) }} margin</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Section -->
  <div class="charts-section" *ngIf="!isLoading && salesReport">
    <!-- Sales by Category Chart -->
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>category</mat-icon>
          Sales by Category
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-placeholder">
          <mat-icon>pie_chart</mat-icon>
          <p>Chart visualization placeholder</p>
          <p class="chart-note">Integrate with Chart.js or ng2-charts for visual display</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Sales by Payment Method Chart -->
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>credit_card</mat-icon>
          Payment Methods
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-placeholder">
          <mat-icon>donut_large</mat-icon>
          <p>Chart visualization placeholder</p>
          <p class="chart-note">Integrate with Chart.js or ng2-charts for visual display</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Daily Sales Trend -->
  <mat-card class="trend-card" *ngIf="!isLoading && salesReport && salesReport.dailyBreakdown">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>show_chart</mat-icon>
        Daily Sales Trend
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="chart-placeholder large">
        <mat-icon>timeline</mat-icon>
        <p>Line chart visualization placeholder</p>
        <p class="chart-note">Integrate with Chart.js or ng2-charts for trend visualization</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Top Selling Products Table -->
  <mat-card class="table-card" *ngIf="!isLoading && salesReport">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>star</mat-icon>
        Top Selling Products
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="topProductsDataSource" matSort #topProductsSort="matSort">
          <ng-container matColumnDef="productName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Product</th>
            <td mat-cell *matCellDef="let product">
              <div class="product-info">
                <span class="product-name">{{ product.productName }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="sku">
            <th mat-header-cell *matHeaderCellDef>SKU</th>
            <td mat-cell *matCellDef="let product">
              <span class="sku">{{ product.sku }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="quantitySold">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Qty Sold</th>
            <td mat-cell *matCellDef="let product">
              <span class="quantity">{{ product.quantitySold }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="revenue">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Revenue</th>
            <td mat-cell *matCellDef="let product">
              <span class="revenue">{{ formatCurrency(product.revenue) }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="profit">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Profit</th>
            <td mat-cell *matCellDef="let product">
              <span class="profit">{{ formatCurrency(product.profit) }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="profitMargin">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Margin</th>
            <td mat-cell *matCellDef="let product">
              <span class="margin">{{ formatPercentage(product.profitMargin) }}</span>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedProductColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedProductColumns;"></tr>
        </table>
      </div>
      <mat-paginator #topProductsPaginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons>
      </mat-paginator>
    </mat-card-content>
  </mat-card>

  <!-- Category Sales Table -->
  <mat-card class="table-card" *ngIf="!isLoading && salesReport">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>category</mat-icon>
        Sales by Category
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="table-container">
        <table mat-table [dataSource]="categorySalesDataSource">
          <ng-container matColumnDef="categoryName">
            <th mat-header-cell *matHeaderCellDef>Category</th>
            <td mat-cell *matCellDef="let category">{{ category.categoryName }}</td>
          </ng-container>

          <ng-container matColumnDef="totalSales">
            <th mat-header-cell *matHeaderCellDef>Sales</th>
            <td mat-cell *matCellDef="let category">{{ formatCurrency(category.totalSales) }}</td>
          </ng-container>

          <ng-container matColumnDef="totalQuantity">
            <th mat-header-cell *matHeaderCellDef>Quantity</th>
            <td mat-cell *matCellDef="let category">{{ category.totalQuantity }}</td>
          </ng-container>

          <ng-container matColumnDef="percentage">
            <th mat-header-cell *matHeaderCellDef>Percentage</th>
            <td mat-cell *matCellDef="let category">
              <div class="percentage-bar">
                <div class="bar-fill" [style.width.%]="category.percentage"></div>
                <span class="bar-text">{{ formatPercentage(category.percentage) }}</span>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedCategoryColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedCategoryColumns;"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>
</div>
