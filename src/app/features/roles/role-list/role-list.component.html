<div class="role-list-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>Role Management</h1>
      <p class="subtitle">Manage user roles and permissions</p>
    </div>
    <div class="header-right">
      <button mat-raised-button color="primary" (click)="createRole()">
        <mat-icon>add</mat-icon>
        Create Role
      </button>
      <button mat-stroked-button (click)="importInput.click()">
        <mat-icon>upload</mat-icon>
        Import
      </button>
      <input #importInput type="file" accept=".json" (change)="importRole($event)" style="display: none" />
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search roles</mat-label>
          <input matInput [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()"
            placeholder="Search by name or description..." />
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select [(ngModel)]="filterStatus" (ngModelChange)="onFilterStatusChange()">
            <mat-option value="all">All Roles</mat-option>
            <mat-option value="active">Active Only</mat-option>
            <mat-option value="inactive">Inactive Only</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Statistics -->
  <div class="statistics-cards">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>security</mat-icon>
        </div>
        <div class="stat-details">
          <h3>Total Roles</h3>
          <div class="stat-value">{{ roles.length }}</div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon active">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="stat-details">
          <h3>Active Roles</h3>
          <div class="stat-value">
            {{ filterRolesByProperty(roles, 'isActive', true).length }}
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon system">
          <mat-icon>lock</mat-icon>
        </div>
        <div class="stat-details">
          <h3>System Roles</h3>
          <div class="stat-value">
            {{ filterRolesByProperty(roles, 'isSystemRole', true).length }}
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Roles Grid -->
  <div class="roles-grid" *ngIf="!loading">
    <mat-card *ngFor="let role of filteredRoles" class="role-card" [class.inactive]="!role.isActive">
      <mat-card-header>
        <div mat-card-avatar class="role-avatar" [style.background]="role.color || '#666'">
          <mat-icon>{{ role.isSystemRole ? 'lock' : 'security' }}</mat-icon>
        </div>
        <mat-card-title>
          {{ role.name }}
          <mat-chip *ngIf="role.isSystemRole" class="system-chip">
            System
          </mat-chip>
        </mat-card-title>
        <mat-card-subtitle>{{ role.description }}</mat-card-subtitle>
        <button mat-icon-button [matMenuTriggerFor]="roleMenu" class="menu-button">
          <mat-icon>more_vert</mat-icon>
        </button>
      </mat-card-header>

      <mat-menu #roleMenu="matMenu">
        <button mat-menu-item (click)="editRole(role)">
          <mat-icon>edit</mat-icon>
          <span>Edit</span>
        </button>
        <button mat-menu-item (click)="viewPermissions(role)">
          <mat-icon>vpn_key</mat-icon>
          <span>Permissions</span>
        </button>
        <button mat-menu-item (click)="duplicateRole(role)">
          <mat-icon>content_copy</mat-icon>
          <span>Duplicate</span>
        </button>
        <button mat-menu-item (click)="exportRole(role)">
          <mat-icon>download</mat-icon>
          <span>Export</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="toggleRoleStatus(role)">
          <mat-icon>{{
            role.isActive ? 'block' : 'check_circle'
            }}</mat-icon>
          <span>{{ role.isActive ? 'Deactivate' : 'Activate' }}</span>
        </button>
        <button mat-menu-item (click)="deleteRole(role)" [disabled]="role.isSystemRole">
          <mat-icon>delete</mat-icon>
          <span>Delete</span>
        </button>
      </mat-menu>

      <mat-card-content>
        <div class="role-stats">
          <div class="stat-item">
            <mat-icon>group</mat-icon>
            <span>{{ getRoleStats(role.id)?.userCount || 0 }} users</span>
          </div>
          <div class="stat-item">
            <mat-icon>vpn_key</mat-icon>
            <span>{{ role.permissions.length }} permissions</span>
          </div>
          <div class="stat-item">
            <mat-icon>priority_high</mat-icon>
            <span>Priority: {{ role.priority }}</span>
          </div>
        </div>

        <div class="role-status">
          <mat-chip [ngClass]="role.isActive ? 'active-chip' : 'inactive-chip'">
            {{ role.isActive ? 'Active' : 'Inactive' }}
          </mat-chip>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary" (click)="editRole(role)">
          <mat-icon>edit</mat-icon>
          Edit
        </button>
        <button mat-button (click)="viewPermissions(role)">
          <mat-icon>vpn_key</mat-icon>
          Permissions
        </button>
      </mat-card-actions>
    </mat-card>

    <!-- Empty State -->
    <div *ngIf="filteredRoles.length === 0" class="empty-state">
      <mat-icon>security</mat-icon>
      <h3>No roles found</h3>
      <p *ngIf="searchQuery">Try adjusting your search criteria</p>
      <p *ngIf="!searchQuery">Create your first role to get started</p>
      <button mat-raised-button color="primary" (click)="createRole()">
        <mat-icon>add</mat-icon>
        Create Role
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <mat-spinner></mat-spinner>
    <p>Loading roles...</p>
  </div>
</div>