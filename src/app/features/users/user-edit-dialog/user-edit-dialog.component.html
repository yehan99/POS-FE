<form class="edit-form" [formGroup]="form" (ngSubmit)="submit()">
    <h2 mat-dialog-title>Edit User</h2>

    <mat-dialog-content>
        <p class="dialog-subtitle">
            Update profile, access level, or site assignment for this user. Changes apply immediately after saving.
        </p>

        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>First Name</mat-label>
                <input matInput formControlName="firstName" autocomplete="given-name" />
                <mat-error *ngIf="form.get('firstName')?.hasError('required')">
                    First name is required
                </mat-error>
                <mat-error *ngIf="form.get('firstName')?.hasError('minlength')">
                    Minimum 2 characters required
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Last Name</mat-label>
                <input matInput formControlName="lastName" autocomplete="family-name" />
                <mat-error *ngIf="form.get('lastName')?.hasError('required')">
                    Last name is required
                </mat-error>
                <mat-error *ngIf="form.get('lastName')?.hasError('minlength')">
                    Minimum 2 characters required
                </mat-error>
            </mat-form-field>
        </div>

        <mat-form-field appearance="outline">
            <mat-label>Email Address</mat-label>
            <input matInput type="email" formControlName="email" autocomplete="email" />
            <mat-error *ngIf="form.get('email')?.hasError('required')">
                Email address is required
            </mat-error>
            <mat-error *ngIf="form.get('email')?.hasError('email')">
                Please enter a valid email address
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Phone Number</mat-label>
            <input matInput type="tel" formControlName="phone" autocomplete="tel" />
        </mat-form-field>

        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>Role</mat-label>
                <mat-select formControlName="roleId">
                    <mat-option *ngFor="let role of roles; trackBy: trackById" [value]="role.id">
                        {{ role.name }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.get('roleId')?.hasError('required')">
                    Please choose a role
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
                <mat-label>Site / Branch</mat-label>
                <mat-select formControlName="siteId">
                    <mat-option *ngFor="let site of sites; trackBy: trackById" [value]="site.id">
                        {{ site.name }}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.get('siteId')?.hasError('required')">
                    Please choose a site
                </mat-error>
                <mat-hint *ngIf="!isSuperAdmin && form.get('siteId')?.value">
                    Site is locked to the active branch
                </mat-hint>
            </mat-form-field>
        </div>

        <mat-slide-toggle formControlName="isActive">
            Active user (can sign in)
        </mat-slide-toggle>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
        <button mat-button type="button" (click)="cancel()" [disabled]="isSaving">
            Cancel
        </button>
        <button mat-flat-button color="primary" type="submit" [disabled]="isSaving">
            <mat-progress-spinner *ngIf="isSaving" diameter="18" mode="indeterminate"></mat-progress-spinner>
            <span *ngIf="!isSaving">Save Changes</span>
        </button>
    </mat-dialog-actions>
</form>