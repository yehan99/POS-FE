<div class="layout-container" [class.sidebar-collapsed]="sidebarCollapsed">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <button class="sidebar-toggle" (click)="toggleSidebar()" aria-label="Toggle sidebar"
        [attr.aria-pressed]="sidebarCollapsed">
        <mat-icon>menu</mat-icon>
      </button>
      <div class="logo">
        <mat-icon class="logo-icon">storefront</mat-icon>
        <span class="logo-text">Paradise POS</span>
      </div>
    </div>

    <div class="header-right">
      <button class="icon-button" aria-label="Search" (click)="openSearch()">
        <mat-icon>search</mat-icon>
      </button>
      <button class="icon-button notification-button" aria-label="Notifications" (click)="toggleNotificationsPanel()"
        [attr.aria-expanded]="notificationsOpen">
        <mat-icon [matBadge]="notificationCount" matBadgeColor="warn" matBadgeSize="small"
          [matBadgeHidden]="notificationCount === 0">
          notifications
        </mat-icon>
      </button>
      <ng-container *ngIf="(siteOptions$ | async) as siteOptions; else siteLoading">
        <ng-container *ngIf="(activeSite$ | async) as activeSite">
          <ng-container *ngIf="(canSwitchSites$ | async); else lockedSite">
            <button class="site-button" [matMenuTriggerFor]="siteSwitcherMenu"
              [disabled]="(isLoadingSites$ | async) === true">
              <mat-icon>storefront</mat-icon>
              <span>{{ activeSite?.name || 'Select site' }}</span>
              <mat-icon>arrow_drop_down</mat-icon>
            </button>
          </ng-container>
          <ng-template #lockedSite>
            <div class="site-pill">
              <mat-icon>storefront</mat-icon>
              <span>{{ activeSite?.name || 'Site not assigned' }}</span>
            </div>
          </ng-template>

          <mat-menu #siteSwitcherMenu="matMenu" class="site-switcher-menu">
            <button mat-menu-item *ngFor="let site of siteOptions" (click)="setActiveSite(site.id)"
              [disabled]="site.id === (activeSite?.id || '')">
              <span>{{ site.name }}</span>
            </button>
          </mat-menu>
        </ng-container>
      </ng-container>
      <ng-template #siteLoading>
        <div class="site-pill skeleton">
          <mat-icon>storefront</mat-icon>
          <span>Loading site…</span>
        </div>
      </ng-template>
      <button class="user-menu" [matMenuTriggerFor]="userMenu">
        <div class="user-avatar">{{ userInitials }}</div>
        <div class="user-info">
          <span class="user-name">{{ userName }}</span>
          <span class="user-role">{{ userRole }}</span>
        </div>
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
      <mat-menu #userMenu="matMenu" class="user-dropdown">
        <button mat-menu-item routerLink="/profile">
          <mat-icon>person</mat-icon>
          <span>Profile</span>
        </button>
        <button mat-menu-item routerLink="/settings">
          <mat-icon>settings</mat-icon>
          <span>Settings</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <nav class="sidebar-nav">
      <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
        class="sidebar-link" title="Dashboard">
        <mat-icon>dashboard</mat-icon>
        <span class="link-text">Dashboard Overview</span>
      </a>

      <div class="sidebar-section">
        <div class="section-title">
          <span>Sales &amp; CRM</span>
        </div>
        <a routerLink="/pos" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="sidebar-link"
          title="POS Checkout">
          <mat-icon>point_of_sale</mat-icon>
          <span class="link-text">POS Checkout</span>
        </a>
        <a routerLink="/pos/transactions" routerLinkActive="active" class="sidebar-link" title="Transactions">
          <mat-icon>receipt_long</mat-icon>
          <span class="link-text">Transactions</span>
        </a>
        <a routerLink="/customers" routerLinkActive="active" class="sidebar-link" title="Customer Directory">
          <mat-icon>people</mat-icon>
          <span class="link-text">Customers</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="section-title">
          <span>Catalog</span>
        </div>
        <a routerLink="/products" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
          class="sidebar-link" title="Products">
          <mat-icon>inventory_2</mat-icon>
          <span class="link-text">Products</span>
        </a>
        <a routerLink="/products/categories" routerLinkActive="active" class="sidebar-link" title="Categories">
          <mat-icon>category</mat-icon>
          <span class="link-text">Categories</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="section-title">
          <span>Inventory</span>
        </div>
        <a routerLink="/inventory" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
          class="sidebar-link" title="Inventory Dashboard">
          <mat-icon>inventory</mat-icon>
          <span class="link-text">Inventory Dashboard</span>
        </a>
        <a routerLink="/inventory/adjustments" routerLinkActive="active" class="sidebar-link" title="Stock Adjustments">
          <mat-icon>tune</mat-icon>
          <span class="link-text">Stock Adjustments</span>
        </a>
        <a routerLink="/inventory/transfers" routerLinkActive="active" class="sidebar-link" title="Stock Transfers">
          <mat-icon>compare_arrows</mat-icon>
          <span class="link-text">Stock Transfers</span>
        </a>
        <a routerLink="/inventory/suppliers" routerLinkActive="active" class="sidebar-link" title="Suppliers">
          <mat-icon>local_shipping</mat-icon>
          <span class="link-text">Suppliers</span>
        </a>
        <a routerLink="/inventory/purchase-orders" routerLinkActive="active" class="sidebar-link"
          title="Purchase Orders">
          <mat-icon>assignment</mat-icon>
          <span class="link-text">Purchase Orders</span>
        </a>
        <a routerLink="/inventory/alerts" routerLinkActive="active" class="sidebar-link" title="Stock Alerts">
          <mat-icon>warning_amber</mat-icon>
          <span class="link-text">Stock Alerts</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="section-title">
          <span>Hardware</span>
        </div>
        <a routerLink="/hardware" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
          class="sidebar-link" title="Hardware Configuration">
          <mat-icon>settings_input_component</mat-icon>
          <span class="link-text">Hardware Configuration</span>
        </a>
        <a routerLink="/hardware/status" routerLinkActive="active" class="sidebar-link" title="Device Status">
          <mat-icon>memory</mat-icon>
          <span class="link-text">Device Status</span>
        </a>
        <a routerLink="/hardware/receipt-designer" routerLinkActive="active" class="sidebar-link"
          title="Receipt Designer">
          <mat-icon>receipt_long</mat-icon>
          <span class="link-text">Receipt Designer</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="section-title">
          <span>Reports &amp; Analytics</span>
        </div>
        <a routerLink="/reports" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
          class="sidebar-link" title="Reports Hub">
          <mat-icon>analytics</mat-icon>
          <span class="link-text">Reports Hub</span>
        </a>
        <a routerLink="/reports/sales" routerLinkActive="active" class="sidebar-link" title="Sales Reports">
          <mat-icon>trending_up</mat-icon>
          <span class="link-text">Sales Reports</span>
        </a>
        <a routerLink="/reports/inventory" routerLinkActive="active" class="sidebar-link" title="Inventory Reports">
          <mat-icon>fact_check</mat-icon>
          <span class="link-text">Inventory Reports</span>
        </a>
        <a routerLink="/reports/customers" routerLinkActive="active" class="sidebar-link" title="Customer Reports">
          <mat-icon>groups</mat-icon>
          <span class="link-text">Customer Reports</span>
        </a>
        <a routerLink="/reports/products" routerLinkActive="active" class="sidebar-link" title="Product Performance">
          <mat-icon>insights</mat-icon>
          <span class="link-text">Product Performance</span>
        </a>
      </div>

      <div class="sidebar-section">
        <div class="section-title">
          <span>Administration</span>
        </div>
        <a routerLink="/users" routerLinkActive="active" class="sidebar-link" title="User Management">
          <mat-icon>group</mat-icon>
          <span class="link-text">User Management</span>
        </a>
        <a routerLink="/settings" routerLinkActive="active" class="sidebar-link" title="Settings">
          <mat-icon>settings</mat-icon>
          <span class="link-text">Settings</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Breadcrumbs -->
    <div class="breadcrumbs" *ngIf="breadcrumbs.length > 0">
      <a *ngFor="let crumb of breadcrumbs; let last = last" [routerLink]="crumb.url" [class.active]="last"
        class="breadcrumb-item">
        {{ crumb.label }}
        <mat-icon *ngIf="!last" class="breadcrumb-separator">chevron_right</mat-icon>
      </a>
    </div>

    <!-- Content -->
    <div class="content">
      <router-outlet></router-outlet>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-left">
        <span class="version">Paradise POS v{{ version }}</span>
        <span class="separator">•</span>
        <span class="copyright">© 2025 Paradise POS. All rights reserved.</span>
      </div>
      <div class="footer-right">
        <a href="#" class="footer-link">Privacy Policy</a>
        <span class="separator">•</span>
        <a href="#" class="footer-link">Terms of Service</a>
        <span class="separator">•</span>
        <a href="#" class="footer-link">Support</a>
      </div>
    </div>
  </footer>
</div>

<div class="notification-workspace" *ngIf="notificationsOpen">
  <button type="button" class="workspace-overlay" aria-label="Close notifications workspace"
    (click)="closeNotificationsPanel()"></button>
  <aside class="workspace-panel" role="dialog" aria-modal="true" aria-label="Notifications workspace" tabindex="-1">
    <div class="workspace-hero">
      <div class="hero-icon">
        <mat-icon>notifications_active</mat-icon>
      </div>
      <div class="hero-copy">
        <p class="hero-title">Notifications</p>
        <p class="hero-subtitle">Stock and supplier updates in real time</p>
        <p class="hero-updated" *ngIf="lastNotificationsRefresh">
          Updated {{ lastNotificationsRefresh | date: 'shortTime' }}
        </p>
      </div>
      <div class="hero-actions">
        <button type="button" class="link-button" (click)="refreshNotifications()" [disabled]="notificationsLoading">
          {{ notificationsLoading ? 'Refreshing...' : 'Refresh' }}
        </button>
        <button type="button" class="link-button" (click)="markAllNotificationsAsRead()"
          [disabled]="notificationCount === 0">
          Mark all as read
        </button>
        <button type="button" class="close-button" aria-label="Close notifications" (click)="closeNotificationsPanel()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <div class="workspace-body">
      <div class="workspace-state" *ngIf="notificationsLoading">
        <mat-progress-spinner diameter="32" mode="indeterminate"></mat-progress-spinner>
        <p>Loading your notifications...</p>
      </div>

      <div class="workspace-state" *ngIf="!notificationsLoading && notificationsError">
        <mat-icon>error_outline</mat-icon>
        <p>{{ notificationsError }}</p>
        <button type="button" class="link-button" (click)="refreshNotifications()">Try again</button>
      </div>

      <div class="workspace-state"
        *ngIf="!notificationsLoading && !notificationsError && notificationGroups.length === 0">
        <mat-icon>mark_email_read</mat-icon>
        <p>You're all caught up.</p>
      </div>

      <ng-container *ngIf="!notificationsLoading && !notificationsError && notificationGroups.length">
        <div class="notification-group" *ngFor="let group of notificationGroups">
          <div class="group-header">
            <div class="group-title">
              <div class="group-icon">
                <mat-icon>{{ group.accentIcon }}</mat-icon>
              </div>
              <div>
                <p>{{ group.title }}</p>
                <span>{{ group.subtitle }}</span>
              </div>
            </div>
            <span class="group-badge" *ngIf="countUnread(group.items) > 0">
              {{ countUnread(group.items) }} new
            </span>
          </div>

          <div class="notification-item" *ngFor="let item of group.items; trackBy: trackByNotification"
            [class.unread]="!item.isRead" role="button" tabindex="0" (click)="openNotificationDetail(item)"
            (keyup.enter)="openNotificationDetail(item)" (keyup.space)="openNotificationDetail(item)">
            <div class="item-avatar" [class.stock]="item.category === 'stock'"
              [class.supplier]="item.category === 'supplier'" [class.product]="item.category === 'product'">
              <img *ngIf="item.actor?.avatarUrl" [src]="item.actor?.avatarUrl" [alt]="item.actor?.name" />
              <span *ngIf="!item.actor?.avatarUrl">{{ getAvatarInitials(item.actor?.name) }}</span>
            </div>
            <div class="item-content">
              <div class="item-head">
                <div class="actor-details">
                  <span class="actor-name">{{ item.actor?.name }}</span>
                  <span class="actor-role" *ngIf="item.actor?.role">• {{ item.actor?.role }}</span>
                </div>
                <span class="time">{{ item.timeAgo }}</span>
              </div>
              <p class="item-title">{{ item.title }}</p>
              <p class="item-message">{{ item.message }}</p>
              <div class="item-meta" *ngIf="item.metadata || item.fileName">
                <span *ngIf="item.metadata">{{ item.metadata }}</span>
                <span *ngIf="item.fileName">
                  {{ item.fileName }}
                  <span class="muted" *ngIf="item.fileSize">{{ item.fileSize }}</span>
                </span>
              </div>
              <div class="item-chip" *ngIf="item.chip">
                <span class="chip" [ngClass]="item.chip.tone">{{ item.chip.label }}</span>
              </div>
              <div class="item-actions" *ngIf="item.actions?.length">
                <button type="button" class="action-button" *ngFor="let action of item.actions"
                  [ngClass]="action.variant || 'secondary'" (click)="handleNotificationAction($event, action, item)">
                  {{ action.label }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <button type="button" class="view-all" (click)="viewAllNotifications()">
      View all notifications
      <mat-icon>chevron_right</mat-icon>
    </button>
  </aside>
</div>